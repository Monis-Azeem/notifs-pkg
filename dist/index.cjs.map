{"version":3,"sources":["../src/index.ts","../src/NotificationManager.ts","../src/schemas/emailNotificationsSchema.ts","../src/schemas/redisSchema.ts","../src/schemas/config.ts"],"sourcesContent":["export * from \"./NotificationManager.ts\";\n","import { Queue, Worker, Job } from \"bullmq\";\nimport {\n  type Config,\n  type EmailNotifications,\n  type Redis,\n} from \"./schemas/index.ts\";\n\nexport class NotificationManager {\n  private queues: Record<string, Queue>;\n  private workers: Record<string, Worker>;\n  private redis: Redis;\n\n  constructor(config: Config) {\n    this.redis = config.redis;\n\n    this.queues = {\n      emailQueue: new Queue(\"email-queue\"),\n    };\n\n    this.workers = {\n      emailWorker: new Worker(\n        \"email-queue\",\n        //TODO: How to manage this job thing\n        async (job: Job) => {\n          console.log(`Email Job processing, Id:-> ${job.id}`);\n        },\n        {\n          connection: {\n            host: this.redis.host,\n            port: this.redis.port,\n          },\n          //TODO: WE can change it i think in the future. Also jobs can be rate limited based on customer id.\n          limiter: {\n            max: 10,\n            duration: 1000,\n          },\n        },\n      ),\n    };\n  }\n\n  async sendEmail(emailNotification: EmailNotifications) {\n    this.queues.emailQueue?.add(\"email-notifications\", emailNotification, {\n      attempts: 3,\n      backoff: {\n        type: \"exponential\",\n        delay: 2000,\n      },\n    });\n\n    this.queues.emailQueue?.on(\"error\", (error) => {\n      console.error(\"Email Queue Error->\");\n      throw new Error(\"Email Queue error->\", error);\n    });\n\n    this.workers.emailWorker?.on(\"error\", (error) => {\n      console.error(\"Email Worker Error->\", error);\n      throw new Error(\"Email Worker error->\", error);\n    });\n  }\n}\n\n//TODO: Also learn about worker removal and job removal before going to production\n","import * as z from \"zod\";\n\nexport const emailNotifications = z.object({\n  email: z.email(),\n  body: z.string().min(1),\n});\n\nexport type EmailNotifications = z.infer<typeof emailNotifications>;\n","import * as z from \"zod\";\n\nexport const redisSchema = z.object({\n  host: z.string().min(1),\n  port: z.number(),\n});\n\nexport type Redis = z.infer<typeof redisSchema>;\n","import * as z from \"zod\";\nimport { redisSchema } from \"./redisSchema.ts\";\n\nexport const config = z.object({\n  redis: redisSchema,\n});\n\nexport type Config = z.infer<typeof config>;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAA,oBAAmC;;;ACAnC,QAAmB;AAEZ,IAAM,qBAAuB,SAAO;AAAA,EACzC,OAAS,QAAM;AAAA,EACf,MAAQ,SAAO,EAAE,IAAI,CAAC;AACxB,CAAC;;;ACLD,IAAAA,KAAmB;AAEZ,IAAM,cAAgB,UAAO;AAAA,EAClC,MAAQ,UAAO,EAAE,IAAI,CAAC;AAAA,EACtB,MAAQ,UAAO;AACjB,CAAC;;;ACLD,IAAAC,KAAmB;AAGZ,IAAM,SAAW,UAAO;AAAA,EAC7B,OAAO;AACT,CAAC;;;AHEM,IAAM,sBAAN,MAA0B;AAAA,EACvB;AAAA,EACA;AAAA,EACA;AAAA,EAER,YAAYC,SAAgB;AAC1B,SAAK,QAAQA,QAAO;AAEpB,SAAK,SAAS;AAAA,MACZ,YAAY,IAAI,oBAAM,aAAa;AAAA,IACrC;AAEA,SAAK,UAAU;AAAA,MACb,aAAa,IAAI;AAAA,QACf;AAAA;AAAA,QAEA,OAAO,QAAa;AAClB,kBAAQ,IAAI,+BAA+B,IAAI,EAAE,EAAE;AAAA,QACrD;AAAA,QACA;AAAA,UACE,YAAY;AAAA,YACV,MAAM,KAAK,MAAM;AAAA,YACjB,MAAM,KAAK,MAAM;AAAA,UACnB;AAAA;AAAA,UAEA,SAAS;AAAA,YACP,KAAK;AAAA,YACL,UAAU;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,UAAU,mBAAuC;AACrD,SAAK,OAAO,YAAY,IAAI,uBAAuB,mBAAmB;AAAA,MACpE,UAAU;AAAA,MACV,SAAS;AAAA,QACP,MAAM;AAAA,QACN,OAAO;AAAA,MACT;AAAA,IACF,CAAC;AAED,SAAK,OAAO,YAAY,GAAG,SAAS,CAAC,UAAU;AAC7C,cAAQ,MAAM,qBAAqB;AACnC,YAAM,IAAI,MAAM,uBAAuB,KAAK;AAAA,IAC9C,CAAC;AAED,SAAK,QAAQ,aAAa,GAAG,SAAS,CAAC,UAAU;AAC/C,cAAQ,MAAM,wBAAwB,KAAK;AAC3C,YAAM,IAAI,MAAM,wBAAwB,KAAK;AAAA,IAC/C,CAAC;AAAA,EACH;AACF;","names":["z","z","config"]}